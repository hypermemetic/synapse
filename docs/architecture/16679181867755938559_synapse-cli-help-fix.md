# Synapse CLI Help Display Fix

**Status**: Implemented
**Date**: 2025-01-03

## Problem

Two issues with synapse CLI help:

1. **Inconsistent help display**: `synapse plexus echo echo` showed parameter help when required args were missing, but `synapse plexus cone create` tried to execute and failed with an RPC error.

2. **`--help` flag ignored**: `synapse plexus cone create --help` showed generic plexus help instead of method-specific help.

## Root Cause

The `<**> helper` combinator from optparse-applicative was intercepting `--help` before synapse could process it for method-specific help. The automatic helper only knows about CLI-level options, not the dynamically-fetched method schemas.

## Solution

### Changes to `app/Main.hs`

1. **Added `argHelp` field to `Args`**:
   ```haskell
   data Args = Args
     { ...
     , argHelp :: Bool  -- New field
     }
   ```

2. **Removed automatic helper from plexus subcommand**:
   ```haskell
   -- Before
   plexusParser = info (plexusArgsParser <**> helper) plexusDesc

   -- After
   plexusParser = info plexusArgsParser plexusDesc
   ```

3. **Added explicit `--help` flag parser**:
   ```haskell
   argHelp <- switch
     (long "help" <> short 'h'
      <> help "Show help (method-specific if path given)")
   ```

4. **Updated dispatch logic**:
   ```haskell
   let helpRequested = argHelp args
                    || "--help" `elem` argPath args
                    || "-h" `elem` argPath args
   ```

## Behavior After Fix

| Command | Result |
|---------|--------|
| `synapse plexus cone create` | Method help (required params missing) |
| `synapse plexus cone create --help` | Method help (explicit) |
| `synapse plexus echo echo --help` | Method help |
| `synapse plexus health check` | Executes (no required params) |
| `synapse plexus --help` | Plexus CLI help with hub schema |

## Related Changes (Same Session)

Also fixed IR codegen issues:

1. **`"definitions"` vs `"$defs"`**: Synapse now checks both for JSON Schema draft-07 compatibility
2. **`KindStringEnum`**: New IR type for simple string enums
3. **`oneOf` with string constants**: Detected and converted to `KindStringEnum`
4. **Discriminator standardization**: Changed `tag = "event"` to `tag = "type"` in substrate
